# bitrix_snippets
Репозиторий представляет собой папку `/local`

- `/demo_pages` - страницы с подключёнными компонентами.
## Компоненты
* **discount.calculate**: генератор временных скидок. В паблике компонент функционал только под авторизацией. При клике по кнопке "получить скидку" в полях формы генерируется рандомный процент скидки и промо-код. Всё это пишется в HL-блок с привязкой к ID текущего пользователя.
<br><br>
Миграция для создания HL прилагается в `local/php_interface/migrations` и запускается в бесплатном модуле из маркета "Миграции для разработчиков" (sprint.migrations).
<br><br>
После генерирования скидка действует 1 час. Если в течение этого времени нажимать кнопку (с перезагрузкой страницы, или без - без разницы, бэк работает по ajax), то выведется активная скидка (процент и промо-код) и количество минут до окончания её действия. Также в папке компонента ест файл `cron.php`. Его можно использовать для периодической очистки неактуальных скидок.
<br><br>
* **items.list**: Список элементов ИБ. Есть `.description.php` и `.parameters.php`, то есть компонент доступен в Визуальном редакторе. Реализован тегированный кеш: при правке элемента инфоблока в админке его кеш очищается по тегу при сохранении (`AddEventHandler` в `init.php`). <br><br>
* **items**: тот же items.list, но подключённый через класс-роутер в комплексном компоненте
