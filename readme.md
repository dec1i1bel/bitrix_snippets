# bitrix_snippets
Репозиторий представляет собой папку `/local`

_**Примечания**_
- `/demo_pages` - страницы с подключёнными компонентами,
- Используются **Bootstrap и JQuery**.
## Компоненты
  * **== random.discount ==**: генератор временных скидок. Подключённый компонент функционален только под авторизацией. Есть 2 шаблона, один работает по ajax с HL-блоком, другой - с ORM. На странице `/demo_pages/discount.php` подключены оба. Соответственно, скидки генерируются отдельно, так как используются разные сущности.
    <br><br>
    При клике по кнопке "получить скидку" в полях формы генерируется рандомный процент скидки и промокод. Всё это пишется в HL-блок или в таблицу БД, в зависимости от выбранного шаблона, с привязкой к ID текущего пользователя.
  <br><br>
  Миграция для создания HL и таблицы прилагаются:
  <br><br>
local/php_interface/migrations/DemoDiscount_HL_20230206230340.php
local/php_interface/migrations/CreateTableRandomDiscount_20230211091728.php
<br><br>
  Через 1 час после генерирования можно получит новую скидку. Если в течение этого времени нажимать кнопку, то выведется активная скидка и количество минут до окончания её действия. Также есть кнопка проверки скидки, по ней промокод активен в течение 3 часов
  <br><br>
  Также в шаблонах есть файл `cron.php`. Его можно использовать для периодической очистки неактуальных скидок.
  <br><br>
* **== items.list ==**: Список элементов ИБ. Есть `.description.php` и `.parameters.php`, то есть компонент доступен в Визуальном редакторе. Реализован тегированный кеш: при правке элемента инфоблока в админке его кеш очищается по тегу при сохранении (`AddEventHandler` в `init.php`). <br><br>
У компонента есть шаблон `blade.default`. Это демо с Blade, результат можно посмотреть на `local/demo_pages/items_list_blade.php`. для его использования нужно установить и подключить пакет Composer в зависимости от версии PHP на вашем сервере:
  * PHP < 8.1 - https://github.com/arrilot/bitrix-blade,
  * PHP >= 8.1 - форк https://github.com/Ge1i0N/bitrix-blade
<br><br>
* **== items ==**: тот же items.list, но подключённый через класс-роутер в комплексном компоненте
